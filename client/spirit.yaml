sources:
  spirit:
    type: MVT
    url: http://localhost:8080/maps/spirit/{z}/{x}/{y}
    max_zoom: 15
scene:
  background:
    color: &land-color '#edf5e8'

styles:
  overlay-lines:
    base: lines
    blend: translucent
  overlay-polygons:
    base: polygons
    blend: translucent
  labels:
    base: text
    draw:
      priority: 900
      text_wrap: 7
      font:
        family: Noto Sans
        size: 14px
        fill: 'black'
        stroke:
          color: 'white'
          width: 1.75px
  linelabels:
    base: text
    draw:
      priority: 900
      text_wrap: false
      font:
        family: Noto Sans
        size: 14px
        fill: 'black'
        stroke:
          color: 'white'
          width: 1.75px
layers:
  water:
    data: { source: spirit }
    draw:
      polygons:
        order: 300
        color: &water-color '#bdd7e7'
  waterways:
    data: { source: spirit }
    rivers:
      filter:
        waterway: river
      draw:
        lines:
          order: 310
          color: *water-color
          width: [[8, 0.1px], [9, 0.2px], [10, 0.4px], [11, 0.6px], [12, 0.8px], [13, 1px], [14, 1.5px], [15, 2px], [16, 3px], [17, 4px], [18, 5px], [19, 6px], [20, 7px]]
    streams:
      filter:
        waterway: stream
      draw:
        lines:
          order: 310
          color: *water-color
          width: [[12, 0px], [13, 0.2px], [14, 0.4px], [15, 0.6px], [16, 0.8px], [17, 1px], [18, 1.5px], [19, 2px]]
    small-waterway:
      filter:
        waterway: [ditch, drain]
      draw:
        lines:
          order: 310
          color: *water-color
          width: [[15, 0.1px], [16, 0.3px], [17, 0.5px], [18, 0.7px], [19, 1px], [20, 1.5px]]
    waterway_names:
      draw:
        linelabels:
          order: 700
          priority: 100
          font:
            fill: '#0868AD'
            stroke:
              color: '#EFF2FB'

  water_names:
    data: { source: spirit }
    draw:
      labels:
        order: 700
        priority: 100
        font:
          fill: '#0868AD'
          stroke:
            color: '#EFF2FB'


  landcover:
    data: { source: spirit }
    industrial:
      filter:
        landuse: industrial
      draw:
        polygons:
          order: 400
          color: '#E9E4D5'
    residential:
      filter:
        landuse: residential
      draw:
        polygons:
          order: 400
          color: '#F5F0E0'
    trees:
      filter:
        - landuse: forest
        - natural: wood
      draw:
        polygons:
          order: 450
          color: '#CCE5CE' # [zoom<=14] { polygon-fill:lighten(@landuse_green2,10%); }
    pitch:
      filter:
        leisure: pitch
      draw:
        polygons:
          order: 420
          color: '#CCE5CE' # [zoom<=14] { polygon-fill:lighten(@landuse_green2,10%); } }
    grass:
      filter:
        landuse: grass
      draw:
        polygons:
          order: 430
          color: '#BBDBB2'
    common:
      filter:
        leisure: common
      draw:
        polygons:
          order: 410
          color: '#BBDBB2'
    park:
      filter:
        leisure: park
      draw:
        polygons:
          order: 410
          color: '#BBDBB2'
    golf_course:
      filter:
        leisure: golf_course
      draw:
        polygons:
          order: 410
          color: '#BBDBB2'
    golf_course:
      filter:
        leisure: golf_course
      draw:
        polygons:
          order: 410
          color: '#BBDBB2'
    draw:
      polygons:
        order: 300
        color: 'red'

  parks:
    data: { source: spirit }
    filter:
      leisure: nature_reserve
    draw:
      overlay-lines:
        order: 480
        color: rgba(120,186,125,0.3)
        width: [[6, 0.4px], [10, 1px], [12, 2px]]
        dash: [2, 2]
      overlay-polygons:
        order: 480
        color: rgba(120,186,125,0.1)

  boundaries:
    data: { source: spirit }
    a2:
      filter:
        admin_level: [0, 1, 2]
      draw:
        overlay-lines:
          order: 510
          color: &boundary-color purple
          width: [[4, 0.3px], [8, 1px]]
    a4:
      filter:
        admin_level: [3, 4]
        $zoom: { min: 4 }
      draw:
        overlay-lines:
          order: 508
          color: [0.5,0,0.5, 0.5]
          width: [[4, 0.5px], [8, 1.5px]]
          dash: [1.5, 3.5]

  buildings:
    data: { source: spirit }
    draw:
      polygons:
        order: 600
        color: '#EDEBDD'
      lines:
        order: 601
        color: '#EEE7BA'
        width: 0.2px

  # transport order occupies 1000 to 2000, and emulates ordering by layer, link, then class
  # We start with a "base" of 1500, which is then adjusted by 100 per layer. Another 50 is
  # added for non-links, and z_order (0-44) is added last
  transport:
    data: { source: spirit }
    # Set up repeated settings for all roads
    _base:
      draw:
        lines:
          order: &road-order function() { return 1500 + feature.layer * 100 + feature.z_order + 50; }
          cap: round
          outline:
            order: &road-link-order function() { return 1500 + feature.layer * 100 + feature.z_order ; }
            cap: butt
    _link:
      filter:
        link: [true]
      draw:
        lines:
          order: *road-link-order
    _tunnel:
      filter:
        tunnel: [true]
      draw:
        lines:
          outline:
            dash: [0.25]

    motorway:
      filter:
        highway: motorway
        $zoom: { min: 4 }
      draw:
        lines:
          color: '#F28B41'
          width: &motor-width [[12, 2.5px], [14, 4px], [16, 8px], [18, 20px]]
          outline:
            color: '#da7d3b'
            width: &motor-outline-width [[12, 0.5px], [14, 1px], [16, 1.25px], [18, 2px]]
      motorway_link:
        filter:
          link: [true]
        draw:
          lines:
            width: &minor-width [[12, 0.8px], [14, 2px], [16, 4px], [18, 14px]]
            outline:
              width: &minor-outline-width [[12, 0px], [14, 1px], [16, 1px], [18, 1.75px]]
      bridge:
        filter:
          bridge: [true]
        draw:
          lines:
            outline:
              color: '#ae642f'
      tunnel:
        filter:
          tunnel: [true]
        draw:
          lines:
            color: '#f5a871'
    trunk:
      filter:
        highway: trunk
        $zoom: { min: 4 }
      draw:
        lines:
          color: '#FECC5D'
          width: *motor-width
          outline:
            color: '#e5b854'
            width: *motor-outline-width
      trunk_link:
        filter:
          link: [true]
        draw:
          lines:
            width: *minor-width
      bridge:
        filter:
          bridge: [true]
        draw:
          lines:
            outline:
              color: '#b79343'
      tunnel:
        filter:
          tunnel: [true]
        draw:
          lines:
            color: '#fedc90'
    primary:
      filter:
        highway: primary
        $zoom: { min: 4 }
      draw:
        lines:
          color: '#FECC5D'
          width: &mainroad-width [[12, 1.2px], [14, 3px], [16, 6px], [18, 17px]]
          outline:
            color: '#e5b854'
            width: &mainroad-outline-width [[12, 0.5px], [14, 1px], [16, 1.25px], [18, 2px]]
      primary_link:
        filter:
          link: [true]
        draw:
          lines:
            width: *minor-width
      bridge:
        filter:
          bridge: [true]
        draw:
          lines:
            outline:
              color: '#b79343'
      tunnel:
        filter:
          tunnel: [true]
        draw:
          lines:
            color: '#fedc90'
    secondary:
      filter:
        highway: secondary
        $zoom: { min: 4 }
      draw:
        lines:
          color: '#FBF4B4'
          width: *mainroad-width
          outline:
            color: '#e2dca2'
            width: *mainroad-outline-width
      secondary_link:
        filter:
          link: [true]
        draw:
          lines:
            width: *minor-width
      bridge:
        filter:
          bridge: [true]
        draw:
          lines:
            outline:
              color: '#ffffff'
      tunnel:
        filter:
          tunnel: [true]
        draw:
          lines:
            color: '#fefbe4'
    tertiary:
      filter:
        highway: tertiary
        $zoom: { min: 4 }
      draw:
        lines:
          color: '#FFFFFF'
          width: *minor-width
          outline:
            color: '#c5cbc1'
            width: *minor-outline-width
      bridge:
        filter:
          bridge: [true]
        draw:
          lines:
            outline:
              color: '#9ea29a'
    residential:
      filter:
        highway: [unclassified, residential]
        $zoom: { min: 4 }
      draw:
        lines:
          color: '#FFFFFF'
          width: *minor-width
          outline:
            color: '#c5cbc1'
            width: *minor-outline-width
      bridge:
        filter:
          bridge: [true]
        draw:
          lines:
            outline:
              color: '#9ea29a'
